```{r}
library(ISLR2)
library(dplyr)
```

# Exploratory Analysis:

## Check for Missing Data: 
```{r}
library(ISLR2)
library(dplyr)

load("~/Downloads/STATS 4620/Boston_Stat4620_2023.RData")
any(is.na(Boston.Stat4620)) # # missing variables exist 
summary(Boston.Stat4620) # Resp variables with 10 NA
```

### We can see from the above data summaries that the mystery response variable has 10 NAs, so we will remove these observations from our dataset.

## Create Variable Summaries:

```{r}
bostonClean <- Boston.Stat4620 %>% filter(!is.na(Resp))  #remove rows with NA
any(is.na(bostonClean)) #Check to make sure it is now FALSE for NA
summary(bostonClean)
```

## Histograms of Predictor Variables: 

```{r}
predictors <- setdiff(names(bostonClean), "Resp")
# Plot first 3
par(mfrow=c(2,2))
for (i in 1:3) {
  hist(bostonClean[[predictors[i]]],
       main = paste("Histogram of", predictors[i]),
       xlab = predictors[i],
       col = "skyblue",
       border = "white")
}

# Plot chas (factor variable)
barplot(table(bostonClean$chas),
        main = "Bar Plot of chas",
        xlab = "chas",
        ylab = "Count",
        col = "skyblue")

# Plot next 4
par(mfrow=c(2,2))
for (i in 5:8) {
  hist(bostonClean[[predictors[i]]],
       main = paste("Histogram of", predictors[i]),
       xlab = predictors[i],
       col = "skyblue",
       border = "white")
}

# Plot last 5
par(mfrow=c(3,3))
for (i in 9:14) {
  hist(bostonClean[[predictors[i]]],
       main = paste("Histogram of", predictors[i]),
       xlab = predictors[i],
       col = "skyblue",
       border = "white")
}
```

## Correlation Matrix:
```{r}
library(ggcorrplot)
bostonClean <- bostonClean %>%
  mutate(Resp = as.numeric(Resp))
numeric_vars <- bostonClean %>% select_if(is.numeric)

# Compute correlation matrix
corr_matrix <- cor(numeric_vars, use = "complete.obs")
resp_corr <- corr_matrix[,"Resp"] %>% sort(decreasing = TRUE)
round(corr_matrix, 2)

ggcorrplot(corr_matrix,
           method = "square",
           type = "lower",
           lab = TRUE,
           lab_size = 2.5,
           title = "Correlation Matrix for Boston Dataset",
           ggtheme = ggplot2::theme_minimal())


# Correlations between predictors and the response variable
resp_corr <- corr_matrix[,"Resp"] %>% sort(decreasing = TRUE)
round(resp_corr, 3)
```

## Using a correlation matrix, we have to look at only numeric variables, so we will further dig into the effect of chas (factor variable) on the response variable visually in the last step of our exploratory analysis. When looking at the correlation matrix, we can make note of a few variables that have significant correlations, some positive and some negative, with our mystery response variable. Note that a negative correlation between two variables is significant if the value is around or less than -0.50, and a positive correlation between two variables is significant if the value is around or greater than 0.50. Knowing this, we can note medv, rm, and zn to have significant negative correlations with Resp. Similarly, lstat, ptratio, and nox have positive significant correlations with Resp. 

## Scatterplots of Predictor Variables and Response Variable:

```{r}
par(mfrow = c(3, 5))
for (var in predictors) {
  plot(bostonClean[[var]], bostonClean$Resp,
       main = paste("Resp vs", var),
       xlab = var, ylab = "Resp",
       col = "blue", pch = 16)
}
title("Figure 1: Scatter plots of each individual predictor variable and the response variable.", outer = TRUE, line = -1, cex.main = 1.5)
```

### To further our exploratory analysis, we plotted each individual predictor variable against the response variable to visually assess potential correlations following the correlation matrix. As shown in Figure 1, several predictors exhibit clear relationships with the response. The variable chas appears to have a binomial relationship with Resp since the spread of values differs noticeably between chas = 0 and chas = 1. The relationship between Resp and nox appears to be roughly positive and linear, whereas rm and zn both show the opposite trend, indicating potential negative linear associations with the response variable. A similar positive linear trend is observed between Resp and ptratio, while medv displays a negative linear pattern. Additionally, lstat may show a positive logistic relationship with Resp as it shows a positive curve-like pattern. The remaining variables display no apparent relationship with Resp, as their scatterplots show randomly scattered points with no discernible trend. Overall, the variables zn, chas, nox, rm, ptratio, medv, and lstat appear to visually have meaningful associations with the response variable. 

### Based on our correlation matrix and our scatterplots of the predictor variables with the response variable, we are confident in using the following predictor variables in our final model: chas, nox, rm, zn, ptratio, medv, and lstat.

# Model Selection:

## Ridge Regression

```{r}
library(glmnet)
library(caret)

set.seed(4620)

# Training data and testing data split
train_index <- createDataPartition(bostonClean$Resp, p = 0.7, list = FALSE)
train <- bostonClean[train_index, ]
test  <- bostonClean[-train_index, ]

x_train <- model.matrix(Resp ~ ., train)[, -1]
y_train <- train$Resp

x_test  <- model.matrix(Resp ~ ., test)[, -1]
y_test  <- test$Resp

ridge_cv <- cv.glmnet(x_train, y_train, alpha = 0)
best_lambda_ridge <- ridge_cv$lambda.min

ridge_pred <- predict(ridge_cv, s = best_lambda_ridge, newx = x_test)

ridge_mse <- mean((ridge_pred - y_test)^2)
cat("Ridge Regression Test MSE:", ridge_mse, "\n")
```

## Lasso Regression

```{r}
lasso_cv <- cv.glmnet(x_train, y_train, alpha = 1)
best_lambda_lasso <- lasso_cv$lambda.min

lasso_pred <- predict(lasso_cv, s = best_lambda_lasso, newx = x_test)

lasso_mse <- mean((lasso_pred - y_test)^2)

cat("Lasso Regression Test MSE:", lasso_mse, "\n")
```
